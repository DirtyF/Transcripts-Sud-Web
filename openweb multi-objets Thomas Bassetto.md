# L'openweb en tant que pierre angulaire du développement multi-objets - Thomas Bassetto

Merci à tous, j'suis très heureux d'être là ce matin, d'autant plus que j'ai grandi pas loin, ça fait plaisir de revenir dans le sud et de retrouver un petit peu de chaleur, je sais pas pour vous, on est quand même plus à l'aise ici et c'est beaucoup plus agréable de prendre un apéro plutôt qu'à Paris, oooh ouuhhh ;)

Donc je viens vous présenter le sujet qui a le titre le plus long et peut-être le plus incompréhensible de Sud Web : l'Open Web en tant que pierre angulaire du développement multi-objets, à vos souhaits ;)

Vite fait comme on m'a présenté, j'ai travaillé chez Jolicloud, si vous étiez là l'année dernière vous avez profité d'une conférence d'un de mes anciens collègues qui vous a présenté comment nous avons crée un système d'exploitation en HTML5 et un peu de Python, j'ai récemment travaillé avec eux puis je suis passé chez JoshFire où je suis développeur Javascript. J'organise pas mal d'évènements, ceux qui sont ici de Paris ou des alentours, je vous encourage à Paris Hackerz, au Paris JS, à PhoneGap Paris, si ces technos web vous intéressent, c'est une bonne occasion de manger des pizzas et de boire des bières le soir avec des amis et je suis correspondant français pour WebFWD, si vous connaissez pas c'est un produit de Mozilla, une entité de Mozilla qui peut vous aider si vous avez un produit open-source conséquent ou si votre start-up utilise beaucoup d'open-source pour faire avancer le web, ils sont là pour vous aider, c'est une sorte d'accélérateur, et n'hésitez pas à faire appel à eux, ils peuvent vous coacher.

Pour vous présenter rapidement Joshfire, l'ADN c'est les objets connectés, ce que j'appelle donc les multi-objets connectés, j'ai pas trouvé mieux pour schématiser ça qu'un grille-pain avec une souris qui est connectée dessus et une espèce de disquette avec une URL qui sort de ses entrailles. C'est un peu l'idée que les gens se font quand on leur parle d'objets connectés, nos objets quotidiens qui sont donc sur le réseau, on a pas toujours une idée de ce que c'est en vrai. 

Un de nos produits c'est la JoshFire Factory, c'est une plate-forme de développement multi-objets justement, de faciliter le processus de mettre une application sur différents types de devises, différentes plate-formes. 

En même temps nous sommes membres du W3C, nous sommes rentrés en même temps que Temesis, nos amis qui doivent être présents dans la salle, c'est très important pour nous de soutenir le W3C, surtout de s'impliquer dans des standards, comme tout ce qui est Linked Data, les groupes Core Mob' et surtout les devices API. 

Et accessoirement on fait aussi d'autres Hackatons sur Paris, n'hésitez pas à venir au Music Hack Paris, au Hack Day Paris, pour vous former un week-end sur de nouvelles technologies web.

Parlons rapidement de définitions, parce que ce titre mine de rien il est assez obscure, les deux termes les plus importants c'est Open Web et multi-objets, la partie multi-objets c'est donc des objets connectés, j'ai une question pour vous, quelle est la première chose à laquelle vous pensez quand je vous dis objet connecté ?

Alors, y'a eu grille-pain, y'a eu Nabaztag, ça c'est un des premiers objets connectés français grand public, j'ai entendu en tout premier frigidaire, c'est très important, parce que souvent on a cette réponse qui est un frigo, un frigo connecté, pourquoi ? Parce qu'ils peuvent vous dire quand est-ce que vos yaourts vont être périmés, ça c'est l'utopie, votre frigo vous prévient aussi des recettes que vous pouvez faire en fonction des légumes que vous avez dans votre frigo, par exemple une ratatouille, si vous avez que des bières effectivement ça va être difficile, et laissez moi vous dire quand même que c'est une utopie, il exige un tumblr qui s'appelle Fuck Yeah Internet Fridge, parce que tout le monde en parle, c'est la première chose, ah ouais les frigos c'est génial mais personne n'arrive à se mettre d'accord, surtout pas la grande distribution, surtout pas les constructeurs de frigos, il n'y a pas de standard, il n'est pas prêt d'avoir de standard malheureusement ça reste une utopie, et pour la petite anecdote lors de mon entretien chez JoshFire, quand ils m'ont dit mais pourquoi t'es venu nous rejoindre, j'ai dit les objets connectés c'est génial, surtout les frigos (rires) et je sais toujours pas s'ils se sont dit OK encore un (rires).

Les frigos connectés on va laisser ça un peu derrière nous, en tout cas nous chez Joshfire les objets connectés c'est tous les objets qui ont une connexion à internet, ça veut dire aussi les tours, les ordinateurs Desktop, les ordinateurs portables, les téléphones, les tablettes, les télés, et bien plus encore comme certains objets que nous fabriquons nous mêmes, Rudy vous a parlé du miroir, on fait un miroir interactif connecté à internet, mais il faut pas oublier les objets de tous les jours qu'on a déjà, ce sont déjà des objets connectés à Internet, ils ont leur place dans cet écosystème. 

Pourquoi ? Au final ils sont bourrés de capteurs même si le téléphone est devenu votre objet pour programmer vos rendez-vous, il ne faut pas oublier qu'à l'intérieur il y a plein de capteurs : GPS, accéléromètre, capteur de luminosité.

S'il nous arrive de faire des application mobiles, on va dire classiques, il nous arrive aussi de prendre des téléphones, de les démonter, pour partir de base à des objets intelligents.

Le dernier en date, c'est un objet à coller sur un frigo, je suis désolé, pour une marque de bouteille d'eau qui voulait un objet en forme de goutte d'eau sur le frigo et qui vous permette de passer commande de bouteilles d'eau avec un écran interactif et à la base nous sommes partis d'un téléphone parce qu'il y a tous les capteurs dont on avait besoin : un écran couleur de 3 pouces tactile, c'est exactement la bonne base pour ce type de produit. 

La deuxième partie importante du titre c'est Open Web. C'est très important car nous réalisons très peu de sites web. Pour ma part aussi bien chez Jolicloud que chez Joshfire, je ne fais pas beaucoup de sites web mais nous utilisons les technos web, voilà pourquoi j'ai dit Open Web. Nous fabriquons des objets et des applications qui sont basés sur HTML, CSS et Javascript mais les contraintes ne sont pas du tout les mêmes que quand on fait un site web.

Donc pourquoi nous avons fait le choix de ces technologies, que je vais appeler technologies hybrides, hybride on dans le sens, je prends l'exemple d'un téléphone : on a l'application native qui est en plein écran ou alors on a une application web qui est dans un navigateur, mais l'interface du navigateur peut gêner à l'utilisation. 

Un compromis existe, on appelle ça les applications hybrides, grosso-modo vous prenez votre application web, vous la mettez dans un conteneur natif, elle est en pleine écran sur votre téléphone comme n'importe quelle application et c'est quand même des technologies web qui sont derrière. 

C'est vrai pour les téléphones, c'est vrai pour les télés, c'est vrai aussi pour les applications Windows/Mac, on peut en faire avec la même technologie et nous utilisons ce principe pour à peu près tous nos développements. La seule exception bien entendu ce sont les objets qui n'ont pas d'interface, ce que je vais appeler les objets ambiants,  qui sont bourrés de capteurs, qui sont connectés au réseau mais vous ne pouvez pas interagir via un écran, y'a rien qui s'affiche. 

La diversité est une bonne chose, mais parfois c'est quand même bien embêtant, je vous apprend rien, il existe de nombreux navigateurs, de nombreuses familles de téléphones, de nombreuses familles de télés, parce que pour ceux qui ne le savent pas quand je parle de télé, je parle de télé connectée, qu'on appelle les SmartTV. Si vous achetez une télé en 2012 voire en 2013, vous pouvez pas y échapper elles ont toutes leur app store, vous allez pas forcément la connecter en Wi-Fi ou en ethernet mais le software est là pour faire tourner des applications. Donc pour s'éviter les problèmes des différents inputs, performance, plateforme, on utilise les technos web, tous permettent d'utiliser un navigateur ou d'avoir une webview dans le reste des cas, c'est parfait. C'est vraiment le point commun mais si nous ne faisons pas de site web, le web c'est vraiment la technologie qui rassemble tous les objets connectés. 

Donc d'un côté l'appli hybride, les technologies web c'est la mutualisation de compétences, je suis dans une entreprise où il n'y a quasiment que des développeurs Javascript, on peut passer d'un projet à un autre, quel qu'il soit sans trop de problème. 

On mutualise aussi notre code, selon les projets pas d'illusion, y'aura jamais 100% du code qui sera partagé entre tous les devices, parce qu'il y aura une perte d'utilité, certains code doivent restés propres à une certaine plateforme, ça varie en ter 30 et 80% de code partagé selon les applications. Et bien sur merci le W3C, c'est royalty free. 

Et au niveau des apps, pourquoi nous ne faisons pas d'application web : pour cette fameuse expérience plein écran, pour l'utilisation des markets, qui est encore très ancrée dans l'esprit des gens, cette idée de rechercher dans le store une application, ce genre de choses et surtout les APIs disponibles, pour accéder aux capteurs, de luminosité, la caméra, etc. on peut pas le faire avec une application web, sur quasiment aucune plateforme, c'est encore trop rare, donc nous sommes obligés de passer par un bridge avec les applications natives et ainsi accéder à toutes les informations disponibles sur le téléphone.

Vite fait je vous montre une expérience, ce que j'appelle une expérience bizarre, une application web ouverte dans Safari où la personne a voulue refaire les canons IOS, mais il y a quelque chose de gênant on a 2 barres, celle de l'application, celle du navigateur à gauche, il y a le bouton back en bas, le bouton news en haut, c'est vraiment une application qui mériterait d'être hybride.

Ça c'est une de nos applications hybrides aussi où on utilise la caméra, c'est quelque chose que l'on aurait pas pu faire avec une application web, et l'avantage aussi c'est qu'on partage le code avec une télé par exemple, on prend des photos, elles apparaissent directement sur la télé, sur une tablette et tout se fait avec les mêmes technologies c'est génial. 

Au niveau de la qualité, on me met souvent au défi. "Oui mais les applications hybrides sont de mauvaise qualité", l'une que l'on a réalisée pour affichée des vidéos, elle a été "vue à la télé". En fait cette application hybride, Apple l'a sélectionnée pour la mettre dans une leur publicité pour l'iPad qui est passée à la télé française. Donc si Apple choisit ce genre d'application, c'est qu'ils doivent pas avoir de problème avec les applications hybrides et typiquement ici c'est une application pour l'AFP, là j'ai juste mis télé, tablette et desktop, ça marche sur Androïd et sur plein d'autres plateformes et plus de 80% du code est le même sur les différentes applications. Je vous laisse imaginer si nous n'avions pas utilisé de technologies web, il aurait fallu refaire pour tablette, le refaire pour télé, avec une techno différente, des développeurs différents, que l'on avait pas dans notre compagnie donc le web ici nous a bien sauvés la vie. 

Quelques hybrides célèbres aussi c'est l'AppStore d'Apple, on voit bien que quelquefois le CSS ne se charge pas, je ne sais pas si ça vous est déjà arrivé, là ce qui est arrivé donc c'est bien une application hybride. Nous avons aussi Facebook, aussi bien sur Androïd que sur Iphone, eux aussi utilisent une application hybride, il y a aussi Wikipédia sur tous les mobiles qui est une application hybride, LinkedIn qui est une application hybride. Et surtout avec le natif, on peut faire des trucs très très moches aussi, y'a pas que le web. 

Au final les problématiques que l'on évite quand on utilise des technologies web dans une application embarquée, dans une application hybride : y'a plus ce problème de SEO, y'a beaucoup moins de problèmes de nombres de requêtes HTTP, elles sont toujours là mais la problématique, l'ordre de grandeur est différent, on accède directement au disque dur on va pas cherche au travers du réseau, et puis on a plus la crainte d'avoir un navigateur sorti de je ne sais où qui vient afficher votre site wbe et qui ne marche pas puisqu'on contrôle l'application qui va afficher. Donc comme je vous dis c'est des technos web, mais on peut pas appeler ça un site web. 

Mais ça inclut des nouvelles problématiques : celle des applications natives, la mise à jour est plus difficile, il faut les faire valider, y'a bien qu'Androïd sur lequel on a pas ce problème mais sur les télés il y est. Il faut prendre en compte le fait que l'application peut être quittée, réouverte, quand elle est quittée il faut sauvegarder les données en local, tout ce genre de choses qui est une problématique des applications natives mais pas de site web, pas forcément. 

Evidemment, cette phrase qu'on entend souvent, à une époque pour Java, maintenant pour le web, c'est pas strictement vrai, y'aura toujours du code spécifique à faire pour certaines plateformes, parce que les bugs de navigateurs, parce que les spécifications qui sont pas implémentées au même niveau encore. Mais pour s'en sortir et partager le plus possible de code, il faut réfléchir, comment adapter l'expérience d'une application, le layout d'une application, le comportement, tout en partageant le coeur applicatif, c'est à dire la logique métier et surtout le contenu de cette application. 

Un exemple, la même application sur mobile, sur tablette, sur télévision avec des gros carrés et du gros texte et sur notre miroir où on a l'application qui a encore un paradigme différent avec la colonne de contenu et d'interaction qui est à droite de l'écran uniquement. Pour faire ça une des techniques la plus simple, vous en avez déjà entendu parler je suppose, c'est le Responsive Web Design ou le design adaptatif en français, je pense qu'il y a d'autres personnes ici qui cherchent un bon terme français pour en parler. 

Le postulat de départ c'est d'utiliser le même code HTML et d'adapter via des feuilles de styles CSS, via des media queries l'affichage de votre contenu en fonction de la taille de votre devise. c'est une première approche pour faire du développement multi-objets, c'est la première mais pas la dernière puisqu'à vous de voir quand est-ce que vous décidez à partir de la taille de l'écran, 1024 pixels, 768 pixels, à quel moment vous décidez de changer l'affichage de grossir la fonte, de changer le menu de position, mais ça ne fait pas tout. Ça marche très bien sur des sites web, par exemple je vais prendre celui de Sud Web, j'adore le voir sur mon mobile, y'a pas de problème pour l'afficher pour l'agrandir mais sur une application qui est plus complexe, sur une application qui utilise je sais pas des interactions 3D, qui fait … un lecteur de mail par exemple comme Gmail, c'est pas évident de garder la même structure et de changer l'affichage de votre application rien qu'avec des CSS, les media queries ne sont pas suffisantes. 

Un exemple, si vous êtes à Sud Web, je pense que vous avez déjà vu du code avec des media queries, je m'excuse si c'est pas très lisible, y'a rien de secret, le premier article sur les responsive web design vous donnera ce code, vous utilisez les media queries avec un breakpoint c'est à dire vous décidez à partir de quelle taille d'écran vous changez le layout de votre site. 

Une autre partie importante, j'ai pas l'équivalent français, c'est la feature détection. Ne faites pas de code en fonction du navigateur, faites du code en fonction des capacités du navigateur, regardez pas le user-agent string, n'essayez pas juste de devenir le nom de l'appareil et d'en déduire les capacités, testez-les. Ce code par exemple qui teste querySelector, localStorage et addEventListener vous permet de décider, enfin c'est mon point de vue, vous permet de décider si c'est un navigateur moderne ou pas, si c'est bon vous aurez probablement accès à beaucoup des dernières technologies web, sinon peut-être vaut-il mieux servir une version de votre application un peu moins performante mais qui fonctionnera sur ces devices. Modernizr c'est le nom à retenir si vous voulez une librairie, qui vous aide à faire cette feature detection, l'utiliser toujours en premier lieu et après checker le user agent string si jamais vous êtes bloqués. 

Les limites du Responsive Web Design et de cette feature détection, c'est que c'est pas suffisant, je vous ai dit pour des applications complexes comme les lecteurs d'emails, la dégradation n'est pas toujours facile à appréhender, n'est pas toujours possible, du coup quelques outils qui peuvent vous aider : Adapt.js et respond.js pour tout ce qui est media queries, les faire comprendre dans les anciens navigateurs comme Internet Explorer mais surtout deux librairies qui ne sont pas assez connues c'est formfactor.js et devise.js. FormFactor en gros ça a été fait par Google, ça vous permet, alors il a une fonction qui s'appelle register, vous donnez une famille de devices, par exemple TV et ensuite des fonctions qui vont décider si c'est une télé ou pas, malheureusement leur code par défaut cherche s'il y a "Samsung" dans le user agent string, c'est pas forcément la meilleure méthode, c'est pas du tout la meilleure méthode mais c'est leur exemple, remplacez ça par la feature détection, vous enregistrez avec FormFactor, une télé c'est tant de pixels, c'est tel devise pour le clavier, pour la souris, et donc on a la TV, vous faites pareil avec les tablettes et les téléphones et ensuite l'application se chargera  de télécharger les CSS et le Javascript correspondants. On commence déjà à faire une application par type, par famille de devices, et c'est un petit peu la grosse décision que nous avons fait chez Joshfire, c'est qu'au finale le responsive web design montre trop de limites, les media queries ne nous suffisent vraiment pas pour faire les applications, donc nous développons en général une application par famille d'objets et ensuite nous utilisons le responsive web design dans cette famille, dans une tablette par exemple pour s'adapter aux différents écrans sur la tablette, pour les téléphones c'est la même chose, pour les télés c'est la même chose.

device.js l'idée est assez intéressante, c'est à dire que dans le code HTML vous utilisez link rel="alternate" avec un lien vers justement  votre application spécifique au mobile, votre application spécifique au desktop ou à la télé et device.js se chargera d'afficher la bonne, c'est une approche qui peut être intéressante, c'est assez récent c'est toujours par des ingénieurs de chez Google, en l'occurrence chez nous on ne l'utilise pas parce qu'on a pas de site web, encore une fois c'est des applications web, on a pas cette fameuse URL qui vous permet d'aller d'un site à un autre.

Dans chaque famille, je vous conseille d'utiliser un framework, pas forcément de réinventer la roue, malheureusement beaucoup de frameworks ne s'intéressent qu'au mobile, jQuery Mobile, Sencha Touch 2, Kendo UI Mobile, il y a bien que Jo qui est pas assez connu qui fait un peu plus que ça, qui fait plus de devices. Donc au final nous n'utilisons pas trop ce genre de framework, sauf pour la famille des mobiles, des frameworks qui ne vous proposent pas de composants UI, il existe backbone.js, Ember, Ender et Zepto, les deux premiers sont les plus connus, je vous conseille de les utiliser, ils ont la plus grosse documentation disponible, Ender c'est une collection de petits scripts, un spécial Ajax, un spécial requêtes CSS, un spécial manipulation DOM, ça vous permet de charger uniquement ce dont vous avez besoin et d'avoir un code Javascript minimaliste, Zepto si je puis me permettre c'est le jQuery light, c'est pas 100% les mêmes fonctions, mais ça peut vous aider.

Ce que nous avons fait au final, si vous avez compris donc, c'est de créer notre propre framework car il n'y en a aucun qui fait tous les devices, il est basé sur backbone.js et require.js, il est sur Github, il est opensource, il est sous licence MIT mais il manque de documentation, c'est pour ça que je ne vous conseille pas de l'utiliser, c'est un projet interne opensource mais sans documentation, c'est pas un vrai projet opensource on est d'accord, à moins que vous soyez vraiment curieux, très compétent pour lire du code écrit par d'autres, mais je vous conseille d'attendre un peu ou de créer votre propre framework. (42:40) 